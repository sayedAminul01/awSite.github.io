<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Speed - AlienWeb Games</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=JetBrains+Mono:wght@400;500;600&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff; font-family: 'Orbitron', sans-serif;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh; padding: 10px;
        }
        
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 {
            font-size: clamp(1.5rem, 4vw, 2.5rem); background: linear-gradient(45deg, #00ff88, #00ccff);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 10px; text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
        }
        
        .stats { display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; }
        .stat {
            background: rgba(0, 255, 136, 0.2); padding: 10px 20px; border-radius: 10px;
            border: 1px solid #00ff88; font-weight: bold; min-width: 100px; text-align: center;
        }
        
        .game-area {
            background: rgba(0, 0, 0, 0.3); border: 2px solid #00ff88; border-radius: 15px;
            padding: 30px; max-width: 800px; width: 100%; margin-bottom: 20px;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
        }
        
        .text-display {
            background: #000; border: 1px solid #00ccff; border-radius: 10px;
            padding: 20px; font-size: 20px; line-height: 1.8; margin-bottom: 20px;
            min-height: 120px; font-family: 'JetBrains Mono', 'Consolas', monospace;
            letter-spacing: 0.5px; font-weight: 500;
        }
        
        .correct { color: #00ff88; }
        .incorrect { color: #ff4444; background: rgba(255, 68, 68, 0.2); }
        .current { background: #00ccff; color: #000; }
        
        #textInput {
            width: 100%; padding: 15px; font-size: 18px; border: 2px solid #00ccff;
            border-radius: 10px; background: rgba(0, 0, 0, 0.7); color: #fff;
            font-family: 'JetBrains Mono', 'Consolas', monospace; outline: none;
            letter-spacing: 0.5px; font-weight: 500;
        }
        
        #textInput:focus { box-shadow: 0 0 15px rgba(0, 204, 255, 0.5); }
        
        .controls { display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; margin-bottom: 20px; }
        
        .btn {
            background: linear-gradient(45deg, #00ff88, #00ccff); border: none;
            padding: 12px 24px; border-radius: 25px; color: #000; font-weight: bold;
            cursor: pointer; transition: all 0.3s ease; font-family: 'Orbitron', sans-serif;
        }
        
        .btn:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(0, 255, 136, 0.4); }
        
        #gameOver {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9); padding: 30px; border-radius: 15px;
            text-align: center; border: 2px solid #00ff88; display: none; z-index: 100;
        }
        
        #instructions {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9); display: flex; align-items: center; justify-content: center;
            z-index: 1000; font-family: 'Orbitron', sans-serif;
        }
        
        .instruction-box {
            background: linear-gradient(135deg, #00ff88, #00ccff); padding: 30px; border-radius: 20px;
            text-align: center; max-width: 500px; color: #000;
        }
        
        .mode-selector {
            display: flex; gap: 10px; justify-content: center; margin-bottom: 15px; flex-wrap: wrap;
        }
        
        .difficulty-selector {
            display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap;
        }
        
        .difficulty-btn {
            background: rgba(0, 255, 136, 0.2); border: 1px solid #00ff88;
            color: #fff; padding: 8px 16px; border-radius: 20px; cursor: pointer;
            transition: all 0.3s ease; font-family: 'Orbitron', sans-serif;
        }
        
        .difficulty-btn.active { background: #00ff88; color: #000; }
        
        @media (max-width: 768px) {
            .game-area { padding: 20px; }
            .text-display { font-size: 16px; padding: 15px; }
            .stats { gap: 10px; }
        }
    </style>
</head>
<body>

<!--     Ads -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3056427584192481"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-3056427584192481"
     data-ad-slot="8067325454"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

    
    <div id="instructions">
        <div class="instruction-box">
            <h2>‚å®Ô∏è Typing Speed Test</h2>
            <p><strong>How to Play:</strong></p>
            <p>‚å®Ô∏è Type the displayed text as fast and accurately as possible</p>
            <p>üéØ Green text = correct, Red text = incorrect</p>
            <p>‚è±Ô∏è Test your WPM (Words Per Minute) and accuracy</p>
            <p>üèÜ Challenge yourself with different difficulty levels!</p>
            <button class="btn" onclick="startGame()" style="margin-top: 20px;">Start Typing</button>
        </div>
    </div>
    
    <div class="header">
        <h1>‚å®Ô∏è Typing Speed Test</h1>
        <p>Test your typing speed and accuracy!</p>
    </div>
    
    <div class="mode-selector">
        <button class="difficulty-btn active" onclick="setMode('test')">Speed Test</button>
        <button class="difficulty-btn" onclick="setMode('lesson')">Lessons</button>
        <button class="difficulty-btn" onclick="setMode('practice')">Practice</button>
    </div>
    
    <div class="difficulty-selector" id="difficultySelector">
        <button class="difficulty-btn active" onclick="setDifficulty('easy')">Easy</button>
        <button class="difficulty-btn" onclick="setDifficulty('medium')">Medium</button>
        <button class="difficulty-btn" onclick="setDifficulty('hard')">Hard</button>
        <button class="difficulty-btn" onclick="setDifficulty('expert')">Expert</button>
    </div>
    
    <div class="difficulty-selector" id="lessonSelector" style="display: none;">
        <button class="difficulty-btn active" onclick="setLesson('homerow')">Home Row</button>
        <button class="difficulty-btn" onclick="setLesson('numbers')">Numbers</button>
        <button class="difficulty-btn" onclick="setLesson('symbols')">Symbols</button>
        <button class="difficulty-btn" onclick="setLesson('words')">Common Words</button>
    </div>
    
    <div class="stats">
        <div class="stat">WPM: <span id="wpm">0</span></div>
        <div class="stat">Accuracy: <span id="accuracy">100</span>%</div>
        <div class="stat">Time: <span id="time">60</span>s</div>
        <div class="stat">Errors: <span id="errors">0</span></div>
        <div class="stat">High Score: <span id="highScore">0</span></div>
        <div class="stat">CPM: <span id="cpm">0</span></div>
        <div class="stat">Progress: <span id="progress">0</span>%</div>
    </div>
    
    <div class="game-area">
        <div class="text-display" id="textDisplay"></div>
        <input type="text" id="textInput" placeholder="Start typing here..." disabled>
    </div>
    
    <div class="controls">
        <button class="btn" onclick="startTest()" id="startBtn">Start Test</button>
        <button class="btn" onclick="resetTest()">Reset</button>
        <button class="btn" onclick="toggleSound()" id="soundBtn">üîä Sound ON</button>
        <button class="btn" onclick="showStats()">üìä Stats</button>
    </div>
    
    <div id="gameOver">
        <h2>Test Complete!</h2>
        <p>WPM: <span id="finalWPM">0</span></p>
        <p>Accuracy: <span id="finalAccuracy">100</span>%</p>
        <p>Total Errors: <span id="finalErrors">0</span></p>
        <p id="newRecord" style="display: none; color: #00ff88; font-weight: bold;">üèÜ New High Score!</p>
        <div style="margin-top: 20px;">
            <button class="btn" onclick="closeResults()">Continue</button>
            <button class="btn" onclick="startTest()">Try Again</button>
            <button class="btn" onclick="window.location.href='index.html'">Back to Menu</button>
        </div>
    </div>
    
    <div id="statsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1001;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(135deg, #1a1a2e, #16213e); padding: 30px; border-radius: 15px; border: 2px solid #00ff88; text-align: center;">
            <h2>üìä Your Statistics</h2>
            <p>High Score: <span id="modalHighScore">0</span> WPM</p>
            <p>Tests Completed: <span id="testsCompleted">0</span></p>
            <p>Total Words Typed: <span id="totalWords">0</span></p>
            <p>Average Accuracy: <span id="avgAccuracy">0</span>%</p>
            <p>Best CPM: <span id="bestCPM">0</span></p>
            <p>Lessons Completed: <span id="lessonsCompleted">0</span></p>
            <canvas id="progressChart" width="300" height="150" style="margin: 10px 0; border: 1px solid #00ff88;"></canvas>
            <div style="margin-top: 20px;">
                <button class="btn" onclick="closeStats()">Close</button>
                <button class="btn" onclick="clearStats()">Clear Stats</button>
            </div>
        </div>
    </div>

    <script>
        let audioContext, soundEnabled = true;
        
        function createSound(freq, dur, type = 'sine', vol = 0.1) {
            if (!soundEnabled || !audioContext) return;
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.connect(gain); gain.connect(audioContext.destination);
            osc.frequency.setValueAtTime(freq, audioContext.currentTime);
            osc.type = type;
            gain.gain.setValueAtTime(vol, audioContext.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + dur);
            osc.start(audioContext.currentTime);
            osc.stop(audioContext.currentTime + dur);
        }
        
        function playSound(type) {
            switch(type) {
                case 'correct': createSound(440, 0.1, 'sine', 0.1); break;
                case 'error': createSound(200, 0.2, 'square', 0.15); break;
                case 'complete': createSound(523, 0.5, 'sine', 0.2); break;
            }
        }
        
        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundBtn').textContent = soundEnabled ? 'üîä Sound ON' : 'üîá Sound OFF';
            if (soundEnabled && !audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
        
        function startGame() {
            document.getElementById('instructions').style.display = 'none';
            if (!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
        
        const texts = {
            easy: [
                "The quick brown fox jumps over the lazy dog.",
                "A journey of a thousand miles begins with a single step.",
                "Life is what happens when you are busy making other plans.",
                "The only way to do great work is to love what you do."
            ],
            medium: [
                "Technology has revolutionized the way we communicate and interact with each other in modern society.",
                "Programming requires logical thinking, problem-solving skills, and attention to detail.",
                "The internet has connected people from all corners of the world, creating a global community.",
                "Artificial intelligence is transforming industries and changing how we approach complex problems."
            ],
            hard: [
                "Quantum computing represents a paradigm shift in computational capabilities, leveraging quantum mechanical phenomena.",
                "Cryptocurrency and blockchain technology have disrupted traditional financial systems through decentralized networks.",
                "Machine learning algorithms analyze vast datasets to identify patterns and make predictions with unprecedented accuracy.",
                "Cybersecurity professionals must constantly adapt to evolving threats in an increasingly interconnected digital landscape."
            ],
            expert: [
                "The implementation of polymorphic algorithms in distributed systems requires careful consideration of load balancing, fault tolerance, and scalability metrics.",
                "Advanced cryptographic protocols utilize elliptic curve cryptography and zero-knowledge proofs to ensure data integrity and privacy preservation.",
                "Microservices architecture patterns leverage containerization technologies like Docker and Kubernetes for orchestration and deployment automation.",
                "Real-time data processing pipelines implement stream processing frameworks with Apache Kafka, Apache Storm, and distributed computing paradigms."
            ],
            lessons: {
                homerow: [
                    "asdf jkl; asdf jkl; asdf jkl;",
                    "aaa sss ddd fff jjj kkk lll ;;;",
                    "ask dad; ask dad; ask dad;",
                    "fallask; fall ask; fall ask;"
                ],
                numbers: [
                    "123 456 789 0 123 456 789 0",
                    "1234567890 1234567890 1234567890",
                    "12 34 56 78 90 12 34 56 78 90",
                    "The year 2024 has 365 days and 12 months."
                ],
                symbols: [
                    "!@# $%^ &*( )_+ !@# $%^ &*( )_+",
                    "Hello! How are you? I'm fine. Thanks!",
                    "Price: $19.99 (20% off) = $15.99",
                    "Email: user@domain.com & phone: (555) 123-4567"
                ],
                words: [
                    "the and for are but not you all can had her was one our out day get has him his how man new now old see two way who boy did its let put say she too use",
                    "about after again air also another any around because been before being between both came come could down each even every find first from give good great hand here home just know last left life little long made make many may most move much must name need never next only other over own place right said same seem should since small still such take than them these they thing think this those through time under until very water well were what when where which while will with work would write year your",
                    "people think great world still should every state those might system better much public new work government way use man day call group number part problem fact hand place case week company where system each right program question during work play government run small number off always move like night live point believe hold today bring happen next without before large all right under while last might us great system new work"
                ]
            }
        };
        
        let gameState = {
            mode: 'test',
            difficulty: 'easy',
            lesson: 'homerow',
            currentText: '',
            userInput: '',
            startTime: null,
            timeLeft: 60,
            isRunning: false,
            currentIndex: 0,
            errors: 0,
            totalTyped: 0,
            wpmHistory: [],
            keystrokeData: []
        };
        
        let timer;
        
        function setMode(mode) {
            gameState.mode = mode;
            document.querySelectorAll('.mode-selector .difficulty-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (mode === 'lesson') {
                document.getElementById('difficultySelector').style.display = 'none';
                document.getElementById('lessonSelector').style.display = 'flex';
            } else {
                document.getElementById('difficultySelector').style.display = 'flex';
                document.getElementById('lessonSelector').style.display = 'none';
            }
            generateText();
        }
        
        function setDifficulty(level) {
            gameState.difficulty = level;
            document.querySelectorAll('#difficultySelector .difficulty-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            generateText();
        }
        
        function setLesson(lesson) {
            gameState.lesson = lesson;
            document.querySelectorAll('#lessonSelector .difficulty-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            generateText();
        }
        
        function generateText() {
            let textArray;
            if (gameState.mode === 'lesson') {
                textArray = texts.lessons[gameState.lesson];
            } else {
                textArray = texts[gameState.difficulty];
            }
            gameState.currentText = textArray[Math.floor(Math.random() * textArray.length)];
            displayText();
        }
        
        function displayText() {
            const display = document.getElementById('textDisplay');
            let html = '';
            
            for (let i = 0; i < gameState.currentText.length; i++) {
                const char = gameState.currentText[i];
                if (i < gameState.currentIndex) {
                    if (gameState.userInput[i] === char) {
                        html += `<span class="correct">${char}</span>`;
                    } else {
                        html += `<span class="incorrect">${char}</span>`;
                    }
                } else if (i === gameState.currentIndex) {
                    html += `<span class="current">${char}</span>`;
                } else {
                    html += char;
                }
            }
            
            display.innerHTML = html;
        }
        
        function startTest() {
            gameState = {
                mode: gameState.mode,
                difficulty: gameState.difficulty,
                lesson: gameState.lesson,
                currentText: '',
                userInput: '',
                startTime: Date.now(),
                timeLeft: 60,
                isRunning: true,
                currentIndex: 0,
                errors: 0,
                totalTyped: 0,
                wpmHistory: [],
                keystrokeData: []
            };
            
            generateText();
            document.getElementById('textInput').disabled = false;
            document.getElementById('textInput').focus();
            document.getElementById('textInput').value = '';
            document.getElementById('startBtn').textContent = 'Testing...';
            document.getElementById('startBtn').disabled = true;
            
            timer = setInterval(updateTimer, 1000);
        }
        
        function updateTimer() {
            gameState.timeLeft--;
            document.getElementById('time').textContent = gameState.timeLeft;
            
            if (gameState.timeLeft <= 0) {
                endTest();
            }
        }
        
        function endTest() {
            gameState.isRunning = false;
            clearInterval(timer);
            document.getElementById('textInput').disabled = true;
            document.getElementById('startBtn').textContent = 'Start Test';
            document.getElementById('startBtn').disabled = false;
            
            const testsCompleted = parseInt(localStorage.getItem('testsCompleted') || 0) + 1;
            const totalWords = parseInt(localStorage.getItem('totalWords') || 0) + Math.floor(gameState.totalTyped / 5);
            const totalAccuracy = parseFloat(localStorage.getItem('totalAccuracy') || 0);
            const newAvgAccuracy = ((totalAccuracy * (testsCompleted - 1)) + calculateAccuracy()) / testsCompleted;
            
            localStorage.setItem('testsCompleted', testsCompleted);
            localStorage.setItem('totalWords', totalWords);
            localStorage.setItem('totalAccuracy', newAvgAccuracy.toFixed(1));
            
            playSound('complete');
            showResults();
        }
        
        function showResults() {
            const wpm = calculateWPM();
            const cpm = calculateCPM();
            const accuracy = calculateAccuracy();
            
            document.getElementById('finalWPM').textContent = wpm;
            document.getElementById('finalAccuracy').textContent = accuracy;
            document.getElementById('finalErrors').textContent = gameState.errors;
            
            const highScore = localStorage.getItem('typingHighScore') || 0;
            const bestCPM = localStorage.getItem('bestCPM') || 0;
            
            if (wpm > highScore) {
                localStorage.setItem('typingHighScore', wpm);
                document.getElementById('newRecord').style.display = 'block';
            }
            
            if (cpm > bestCPM) {
                localStorage.setItem('bestCPM', cpm);
            }
            
            if (gameState.mode === 'lesson' && accuracy >= 95) {
                const lessonsCompleted = parseInt(localStorage.getItem('lessonsCompleted') || 0) + 1;
                localStorage.setItem('lessonsCompleted', lessonsCompleted);
            }
            
            document.getElementById('gameOver').style.display = 'block';
        }
        
        function calculateWPM() {
            const timeElapsed = (60 - gameState.timeLeft) / 60;
            const wordsTyped = gameState.totalTyped / 10;
            return Math.round(wordsTyped / timeElapsed) || 0;
        }
        
        function calculateCPM() {
            const timeElapsed = (60 - gameState.timeLeft) / 60;
            return Math.round(gameState.totalTyped / timeElapsed) || 0;
        }
        
        function calculateAccuracy() {
            if (gameState.totalTyped === 0) return 100;
            return Math.round(((gameState.totalTyped - gameState.errors) / gameState.totalTyped) * 100);
        }
        
        function updateStats() {
            const wpm = calculateWPM();
            const cpm = calculateCPM();
            const progress = Math.round((gameState.currentIndex / gameState.currentText.length) * 100);
            
            document.getElementById('wpm').textContent = wpm;
            document.getElementById('cpm').textContent = cpm;
            document.getElementById('accuracy').textContent = calculateAccuracy();
            document.getElementById('errors').textContent = gameState.errors;
            document.getElementById('progress').textContent = progress;
            document.getElementById('highScore').textContent = localStorage.getItem('typingHighScore') || 0;
            
            // Track WPM history for chart
            if (gameState.isRunning && wpm > 0) {
                gameState.wpmHistory.push({ time: 60 - gameState.timeLeft, wpm: wpm });
            }
        }
        
        function resetTest() {
            clearInterval(timer);
            gameState = {
                mode: gameState.mode,
                difficulty: gameState.difficulty,
                lesson: gameState.lesson,
                currentText: '',
                userInput: '',
                startTime: null,
                timeLeft: 60,
                isRunning: false,
                currentIndex: 0,
                errors: 0,
                totalTyped: 0,
                wpmHistory: [],
                keystrokeData: []
            };
            
            document.getElementById('textInput').disabled = true;
            document.getElementById('textInput').value = '';
            document.getElementById('startBtn').textContent = 'Start Test';
            document.getElementById('startBtn').disabled = false;
            document.getElementById('time').textContent = '60';
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('newRecord').style.display = 'none';
            
            generateText();
            updateStats();
        }
        
        function closeResults() {
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('newRecord').style.display = 'none';
        }
        
        function showStats() {
            document.getElementById('modalHighScore').textContent = localStorage.getItem('typingHighScore') || 0;
            document.getElementById('testsCompleted').textContent = localStorage.getItem('testsCompleted') || 0;
            document.getElementById('totalWords').textContent = localStorage.getItem('totalWords') || 0;
            document.getElementById('avgAccuracy').textContent = localStorage.getItem('totalAccuracy') || 0;
            document.getElementById('bestCPM').textContent = localStorage.getItem('bestCPM') || 0;
            document.getElementById('lessonsCompleted').textContent = localStorage.getItem('lessonsCompleted') || 0;
            
            drawProgressChart();
            document.getElementById('statsModal').style.display = 'block';
        }
        
        function closeStats() {
            document.getElementById('statsModal').style.display = 'none';
        }
        
        function clearStats() {
            localStorage.removeItem('typingHighScore');
            localStorage.removeItem('testsCompleted');
            localStorage.removeItem('totalWords');
            localStorage.removeItem('totalAccuracy');
            localStorage.removeItem('bestCPM');
            localStorage.removeItem('lessonsCompleted');
            updateStats();
            closeStats();
        }
        
        function drawProgressChart() {
            const canvas = document.getElementById('progressChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (gameState.wpmHistory.length < 2) {
                ctx.fillStyle = '#00ff88';
                ctx.font = '14px Orbitron';
                ctx.textAlign = 'center';
                ctx.fillText('Complete a test to see progress', canvas.width/2, canvas.height/2);
                return;
            }
            
            const maxWPM = Math.max(...gameState.wpmHistory.map(h => h.wpm), 50);
            const maxTime = Math.max(...gameState.wpmHistory.map(h => h.time));
            
            // Draw grid
            ctx.strokeStyle = 'rgba(0, 255, 136, 0.2)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = (i / 5) * canvas.height;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // Draw progress line
            ctx.strokeStyle = '#00ff88';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            gameState.wpmHistory.forEach((point, index) => {
                const x = (point.time / maxTime) * canvas.width;
                const y = canvas.height - (point.wpm / maxWPM) * canvas.height;
                
                if (index === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            
            ctx.stroke();
        }
        
        // Input handling
        document.getElementById('textInput').addEventListener('input', (e) => {
            if (!gameState.isRunning) return;
            
            const input = e.target.value;
            
            // Prevent input beyond text length
            if (input.length > gameState.currentText.length) {
                e.target.value = input.substring(0, gameState.currentText.length);
                return;
            }
            
            gameState.userInput = input;
            gameState.currentIndex = input.length;
            gameState.totalTyped = Math.max(gameState.totalTyped, input.length);
            
            // Count errors
            gameState.errors = 0;
            for (let i = 0; i < input.length; i++) {
                if (input[i] !== gameState.currentText[i]) {
                    gameState.errors++;
                }
            }
            
            // Play sound feedback
            if (input.length > gameState.userInput.length) {
                const lastChar = input[input.length - 1];
                const expectedChar = gameState.currentText[input.length - 1];
                
                if (lastChar === expectedChar) {
                    playSound('correct');
                } else {
                    playSound('error');
                }
            }
            
            displayText();
            updateStats();
            
            // Check if text is complete
            if (input === gameState.currentText) {
                endTest();
            }
        });
        
        // Prevent backspace beyond current position
        document.getElementById('textInput').addEventListener('keydown', (e) => {
            if (!gameState.isRunning) return;
            
            if (e.key === 'Backspace' && e.target.selectionStart < gameState.currentIndex) {
                e.preventDefault();
            }
        });
        
        // Initialize
        generateText();
        updateStats();
    </script>
</body>
</html>
